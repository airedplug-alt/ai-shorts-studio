<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI SHORTS STUDIO PRO v1.0.0</title>
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â• CSS RESET & VARIABLES â•â•â•â•â•â•â• */
:root {
  --void:#010409; --deep:#0d1117; --card:#161b22; --card2:#1c2128;
  --hover:#21262d; --border:#30363d; --brite:#484f58;
  --cyan:#00d4ff; --purple:#7c3aed; --green:#3fb950;
  --orange:#e3700a; --red:#f85149; --yellow:#d29922; --pink:#f778ba;
  --text1:#e6edf3; --text2:#8b949e; --text3:#484f58;
  --glow-cyan: 0 0 12px rgba(0,212,255,.3);
  --glow-purple: 0 0 12px rgba(124,58,237,.3);
  --glow-green: 0 0 12px rgba(63,185,80,.3);
  --radius: 10px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{height:100%;scroll-behavior:smooth}
body{
  background:var(--void);color:var(--text1);font-family:'Noto Sans KR',sans-serif;
  height:100%;overflow:hidden;
  background-image:
    linear-gradient(rgba(0,212,255,.015) 1px,transparent 1px),
    linear-gradient(90deg,rgba(0,212,255,.015) 1px,transparent 1px);
  background-size:44px 44px;
}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--brite);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--text2)}
::selection{background:rgba(0,212,255,.2);color:#fff}
a{color:var(--cyan);text-decoration:none}
a:hover{text-decoration:underline}

/* â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• */
.hdr{
  position:fixed;top:0;left:0;right:0;z-index:200;height:52px;
  background:rgba(1,4,9,.95);border-bottom:1px solid var(--border);
  backdrop-filter:blur(20px);padding:0 16px;
  display:flex;align-items:center;justify-content:space-between;gap:12px;
}
.logo{display:flex;align-items:center;gap:10px;flex-shrink:0}
.logo-icon{
  width:32px;height:32px;border-radius:8px;
  background:linear-gradient(135deg,var(--cyan),var(--purple));
  display:flex;align-items:center;justify-content:center;font-size:15px;
  box-shadow:var(--glow-cyan);
}
.logo-name{
  font-family:'Orbitron',monospace;font-weight:900;font-size:12px;letter-spacing:2px;
  background:linear-gradient(135deg,var(--cyan),var(--purple));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.logo-ver{
  font-size:9px;color:var(--text3);font-family:'JetBrains Mono',monospace;
  border:1px solid var(--border);padding:2px 5px;border-radius:3px;
}
.hdr-center{display:flex;align-items:center;gap:8px}
.nav-tab{
  padding:4px 10px;border-radius:5px;border:1px solid transparent;
  background:transparent;color:var(--text2);font-size:10.5px;cursor:pointer;
  font-family:'Noto Sans KR',sans-serif;transition:all .2s;
  display:flex;align-items:center;gap:4px;
}
.nav-tab:hover{color:var(--text1);background:var(--hover)}
.nav-tab.active{border-color:var(--cyan);color:var(--cyan);background:rgba(0,212,255,.06)}
.hdr-status{display:flex;align-items:center;gap:10px;flex-shrink:0}
.status-pill{display:flex;align-items:center;gap:5px;font-size:9.5px;font-family:'JetBrains Mono',monospace;color:var(--text2)}
.dot{width:7px;height:7px;border-radius:50%;animation:blink 2s ease-in-out infinite}
.dot.ok{background:var(--green);box-shadow:0 0 5px var(--green)}
.dot.warn{background:var(--yellow);box-shadow:0 0 5px var(--yellow)}
.dot.err{background:var(--red);box-shadow:0 0 5px var(--red)}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}

/* â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â• */
.layout{display:grid;grid-template-columns:280px 1fr 300px;height:calc(100vh - 52px);margin-top:52px}
.left-panel,.center-panel,.right-panel{overflow-y:auto;overflow-x:hidden;height:100%}
.left-panel{border-right:1px solid var(--border);padding:10px;display:flex;flex-direction:column;gap:8px}
.center-panel{padding:12px;display:flex;flex-direction:column;gap:10px}
.right-panel{border-left:1px solid var(--border);padding:10px;display:flex;flex-direction:column;gap:8px}

/* â•â•â•â•â•â•â• TAB CONTENT â•â•â•â•â•â•â• */
.tab-content{display:none;flex-direction:column;gap:10px;flex:1;min-height:0}
.tab-content.active{display:flex}

/* â•â•â•â•â•â•â• CARD â•â•â•â•â•â•â• */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:border-color .2s;flex-shrink:0}
.card:hover{border-color:var(--brite)}
.card-hd{
  padding:7px 11px;background:var(--card2);border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.card-title{font-size:10.5px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;color:var(--text2);display:flex;align-items:center;gap:5px}
.card-bd{padding:9px 11px}
.card.accent{border-color:rgba(0,212,255,.2)}
.card.accent .card-hd{background:rgba(0,212,255,.04)}

/* â•â•â•â•â•â•â• FORM ELEMENTS â•â•â•â•â•â•â• */
textarea,input[type="text"],input[type="number"],input[type="color"],select{
  width:100%;background:var(--deep);border:1px solid var(--border);border-radius:6px;
  color:var(--text1);font-family:'Noto Sans KR',sans-serif;font-size:12px;
  padding:7px 9px;outline:none;transition:border-color .2s;
}
textarea:focus,input:focus,select:focus{border-color:var(--cyan)}
textarea{resize:vertical;min-height:60px;line-height:1.5}
select{cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%238b949e'%3E%3Cpath d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 8px center;padding-right:24px;
}
label{font-size:10px;font-weight:500;color:var(--text2);letter-spacing:.4px;margin-bottom:2px;display:block}

.form-row{display:flex;gap:8px;align-items:end}
.form-row>*{flex:1}
.form-group{display:flex;flex-direction:column;gap:3px;margin-bottom:6px}

/* â•â•â•â•â•â•â• BUTTONS â•â•â•â•â•â•â• */
.btn{
  border:1px solid var(--border);border-radius:6px;padding:7px 14px;cursor:pointer;
  font-family:'Noto Sans KR',sans-serif;font-size:11.5px;font-weight:600;
  transition:all .2s;display:inline-flex;align-items:center;gap:5px;
  white-space:nowrap;
}
.btn-primary{
  background:linear-gradient(135deg,var(--cyan),var(--purple));
  border-color:transparent;color:#fff;
  box-shadow:var(--glow-cyan);
}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 0 20px rgba(0,212,255,.4)}
.btn-primary:disabled{opacity:.5;pointer-events:none}
.btn-secondary{background:var(--card2);color:var(--text1)}
.btn-secondary:hover{background:var(--hover);border-color:var(--brite)}
.btn-danger{background:rgba(248,81,73,.1);border-color:rgba(248,81,73,.3);color:var(--red)}
.btn-danger:hover{background:rgba(248,81,73,.2)}
.btn-green{background:rgba(63,185,80,.1);border-color:rgba(63,185,80,.3);color:var(--green)}
.btn-green:hover{background:rgba(63,185,80,.2)}
.btn-sm{padding:4px 8px;font-size:10px}
.btn-full{width:100%;justify-content:center}
.btn-group{display:flex;gap:4px;flex-wrap:wrap}

/* â•â•â•â•â•â•â• RADIO GROUP â•â•â•â•â•â•â• */
.radio-group{display:flex;gap:4px;flex-wrap:wrap}
.radio-opt{
  padding:4px 10px;border-radius:5px;border:1px solid var(--border);
  background:var(--deep);color:var(--text2);font-size:10px;cursor:pointer;
  transition:all .2s;display:flex;align-items:center;gap:3px;
}
.radio-opt:hover{border-color:var(--brite);color:var(--text1)}
.radio-opt.active{border-color:var(--cyan);color:var(--cyan);background:rgba(0,212,255,.06)}
.radio-opt input{display:none}

/* â•â•â•â•â•â•â• SCENARIO COMPARISON â•â•â•â•â•â•â• */
.scenario-compare{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:8px 0}
.scenario-card{
  background:var(--card);border:2px solid var(--border);border-radius:var(--radius);
  padding:10px;cursor:pointer;transition:all .3s;position:relative;
}
.scenario-card:hover{border-color:var(--brite)}
.scenario-card.selected{border-color:var(--cyan);box-shadow:var(--glow-cyan)}
.scenario-card .sc-badge{
  position:absolute;top:-8px;left:12px;
  font-size:9px;font-weight:700;padding:2px 8px;border-radius:3px;
  background:linear-gradient(135deg,var(--cyan),var(--purple));color:#fff;
}
.scenario-card .sc-style{font-size:11px;font-weight:700;margin:6px 0 4px;display:flex;align-items:center;gap:4px}
.scenario-card .sc-preview{font-size:10.5px;color:var(--text2);line-height:1.5;max-height:80px;overflow:hidden}

/* â•â•â•â•â•â•â• SCENE LIST â•â•â•â•â•â•â• */
.scene-list{display:flex;flex-direction:column;gap:6px;max-height:400px;overflow-y:auto}
.scene-item{
  background:var(--deep);border:1px solid var(--border);border-radius:8px;
  padding:8px;transition:all .2s;
}
.scene-item:hover{border-color:var(--brite)}
.scene-item .si-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
.scene-item .si-num{
  font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:700;
  color:var(--cyan);background:rgba(0,212,255,.1);padding:2px 6px;border-radius:3px;
}
.scene-item .si-dur{font-size:9px;color:var(--text3);font-family:'JetBrains Mono',monospace}
.scene-item .si-narr{font-size:10.5px;line-height:1.4;color:var(--text2);margin-bottom:4px}
.scene-item .si-details{display:grid;grid-template-columns:1fr 1fr;gap:3px;font-size:9.5px;color:var(--text3)}
.scene-item .si-details span{display:flex;align-items:center;gap:2px}
.scene-item textarea{min-height:38px;font-size:10px;margin-top:3px}

/* â•â•â•â•â•â•â• PROGRESS â•â•â•â•â•â•â• */
.progress-panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;display:none}
.progress-panel.active{display:block}
.prog-header{padding:10px 12px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.prog-title{font-size:11px;font-weight:700;color:var(--cyan);display:flex;align-items:center;gap:5px}
.prog-eta{font-size:10px;color:var(--text2);font-family:'JetBrains Mono',monospace}
.prog-bar-wrap{height:4px;background:var(--deep);margin:0 12px 8px}
.prog-bar{height:100%;background:linear-gradient(90deg,var(--cyan),var(--purple));border-radius:2px;transition:width .5s ease;width:0%}
.prog-body{padding:8px 12px;max-height:200px;overflow-y:auto}
.prog-scene{
  display:flex;align-items:center;gap:8px;padding:3px 0;font-size:10px;
  border-bottom:1px solid rgba(48,54,61,.3);
}
.prog-scene:last-child{border-bottom:none}
.prog-scene .ps-num{width:50px;font-family:'JetBrains Mono',monospace;color:var(--text3)}
.prog-scene .ps-status{flex:1}
.prog-scene .ps-time{width:40px;text-align:right;font-family:'JetBrains Mono',monospace;color:var(--text3)}
.prog-scene.done .ps-num{color:var(--green)}
.prog-scene.done .ps-status{color:var(--green)}
.prog-scene.active .ps-num{color:var(--cyan)}
.prog-scene.active .ps-status{color:var(--cyan)}
.prog-scene.active .ps-status::after{content:' ...';animation:dots 1.5s steps(3,end) infinite}
@keyframes dots{0%{content:' .'}33%{content:' ..'}66%{content:' ...'}}
.prog-gpu{
  padding:6px 12px;background:var(--card2);border-top:1px solid var(--border);
  display:flex;gap:12px;font-size:9px;color:var(--text3);font-family:'JetBrains Mono',monospace;
}
.prog-gpu span{display:flex;align-items:center;gap:3px}

/* â•â•â•â•â•â•â• JOB LIST / HISTORY â•â•â•â•â•â•â• */
.job-item{
  background:var(--deep);border:1px solid var(--border);border-radius:8px;
  padding:8px 10px;margin-bottom:4px;display:flex;flex-direction:column;gap:4px;
  transition:all .2s;
}
.job-item:hover{border-color:var(--brite)}
.job-item .ji-row{display:flex;justify-content:space-between;align-items:center}
.job-item .ji-title{font-size:11px;font-weight:600;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.job-item .ji-status{
  font-size:9px;padding:2px 6px;border-radius:3px;font-weight:600;
  font-family:'JetBrains Mono',monospace;
}
.ji-status.running{color:var(--cyan);background:rgba(0,212,255,.1)}
.ji-status.completed{color:var(--green);background:rgba(63,185,80,.1)}
.ji-status.failed{color:var(--red);background:rgba(248,81,73,.1)}
.ji-status.pending{color:var(--yellow);background:rgba(210,153,34,.1)}
.ji-status.cancelled{color:var(--text3);background:rgba(72,79,88,.2)}
.job-item .ji-meta{font-size:9px;color:var(--text3);font-family:'JetBrains Mono',monospace}
.job-item .ji-actions{display:flex;gap:3px;margin-top:2px}
.job-item .ji-progress{height:2px;background:var(--deep);border-radius:1px;overflow:hidden;margin-top:2px}
.job-item .ji-progress .bar{height:100%;background:linear-gradient(90deg,var(--cyan),var(--purple));transition:width .3s}

/* â•â•â•â•â•â•â• OUTPUT GALLERY â•â•â•â•â•â•â• */
.gallery{display:flex;flex-direction:column;gap:8px}
.gallery-item{
  background:var(--deep);border:1px solid var(--border);border-radius:8px;
  overflow:hidden;transition:all .2s;
}
.gallery-item:hover{border-color:var(--brite)}
.gallery-item video{width:100%;max-height:200px;object-fit:contain;background:#000}
.gallery-item .gi-info{padding:6px 8px;display:flex;justify-content:space-between;align-items:center}
.gallery-item .gi-name{font-size:10px;color:var(--text2);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.gallery-item .gi-size{font-size:9px;color:var(--text3);font-family:'JetBrains Mono',monospace}
.gallery-item .gi-actions{display:flex;gap:3px;padding:4px 8px;border-top:1px solid var(--border)}

/* â•â•â•â•â•â•â• SETTINGS MODAL â•â•â•â•â•â•â• */
.modal-overlay{
  display:none;position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(1,4,9,.85);z-index:300;
  align-items:center;justify-content:center;
  backdrop-filter:blur(4px);
}
.modal-overlay.active{display:flex}
.modal{
  background:var(--card);border:1px solid var(--border);border-radius:12px;
  width:90%;max-width:700px;max-height:85vh;overflow:hidden;
  box-shadow:0 25px 60px rgba(0,0,0,.5);
}
.modal-hd{
  padding:12px 16px;border-bottom:1px solid var(--border);
  display:flex;justify-content:space-between;align-items:center;
  background:var(--card2);
}
.modal-hd h3{font-size:14px;font-weight:700;display:flex;align-items:center;gap:6px}
.modal-close{
  background:none;border:none;color:var(--text2);font-size:18px;cursor:pointer;
  width:28px;height:28px;display:flex;align-items:center;justify-content:center;
  border-radius:4px;
}
.modal-close:hover{background:var(--hover);color:var(--text1)}
.modal-bd{padding:16px;overflow-y:auto;max-height:calc(85vh - 60px)}
.modal-tabs{display:flex;gap:2px;margin-bottom:12px;border-bottom:1px solid var(--border);padding-bottom:6px}
.modal-tab{
  padding:6px 12px;border-radius:5px 5px 0 0;border:1px solid transparent;
  background:transparent;color:var(--text2);font-size:11px;cursor:pointer;
  font-family:'Noto Sans KR',sans-serif;transition:all .2s;
}
.modal-tab:hover{color:var(--text1)}
.modal-tab.active{color:var(--cyan);border-color:var(--border);border-bottom-color:var(--card);background:var(--card)}
.settings-section{display:none}
.settings-section.active{display:block}
.settings-section h4{font-size:12px;font-weight:700;margin:10px 0 6px;padding-bottom:4px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:5px}
.settings-row{display:flex;gap:10px;margin-bottom:8px;align-items:start}
.settings-row label{min-width:90px;font-size:10.5px;color:var(--text2);padding-top:8px}
.settings-row .input-wrap{flex:1}
.settings-hint{font-size:9px;color:var(--text3);margin-top:2px}

/* â•â•â•â•â•â•â• HELP / TOOLTIP â•â•â•â•â•â•â• */
.tooltip{position:relative;cursor:help}
.tooltip::after{
  content:attr(data-tip);position:absolute;bottom:calc(100% + 6px);left:50%;
  transform:translateX(-50%);background:var(--card2);border:1px solid var(--border);
  color:var(--text1);font-size:10px;padding:4px 8px;border-radius:4px;
  white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .2s;z-index:100;
}
.tooltip:hover::after{opacity:1}

/* â•â•â•â•â•â•â• TAGS â•â•â•â•â•â•â• */
.tag{
  display:inline-flex;align-items:center;gap:3px;
  padding:2px 7px;border-radius:4px;font-size:9px;font-weight:600;
  background:rgba(0,212,255,.08);color:var(--cyan);border:1px solid rgba(0,212,255,.15);
}
.tag.green{background:rgba(63,185,80,.08);color:var(--green);border-color:rgba(63,185,80,.15)}
.tag.purple{background:rgba(124,58,237,.08);color:var(--purple);border-color:rgba(124,58,237,.15)}
.tag.orange{background:rgba(227,112,10,.08);color:var(--orange);border-color:rgba(227,112,10,.15)}
.tag.red{background:rgba(248,81,73,.08);color:var(--red);border-color:rgba(248,81,73,.15)}

/* â•â•â•â•â•â•â• SPINNER â•â•â•â•â•â•â• */
.spinner{display:inline-block;width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--cyan);border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* â•â•â•â•â•â•â• MISC â•â•â•â•â•â•â• */
.empty-state{text-align:center;padding:30px;color:var(--text3);font-size:11px}
.empty-state .es-icon{font-size:28px;margin-bottom:8px;opacity:.5}
.divider{height:1px;background:var(--border);margin:8px 0}
.text-cyan{color:var(--cyan)}
.text-green{color:var(--green)}
.text-red{color:var(--red)}
.text-yellow{color:var(--yellow)}
.text-muted{color:var(--text3)}
.mono{font-family:'JetBrains Mono',monospace}
.flex-between{display:flex;justify-content:space-between;align-items:center}
.gap-4{gap:4px}
.mb-4{margin-bottom:4px}
.mt-4{margin-top:4px}
.hidden{display:none !important}

/* â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â• */
@media(max-width:1200px){.layout{grid-template-columns:240px 1fr 260px}}
@media(max-width:900px){
  .layout{grid-template-columns:1fr;grid-template-rows:auto 1fr auto}
  .left-panel,.right-panel{max-height:35vh}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• -->
<header class="hdr">
  <div class="logo">
    <div class="logo-icon">AI</div>
    <div>
      <div class="logo-name">SHORTS STUDIO</div>
      <div style="display:flex;align-items:center;gap:6px">
        <span class="logo-ver" id="verLabel">v1.0.0</span>
        <span style="font-size:8px;color:var(--text3);font-family:'JetBrains Mono',monospace">Â© chally.choi</span>
      </div>
    </div>
  </div>
  <div class="hdr-center">
    <button class="nav-tab active" data-tab="create">ğŸ¬ AI ì˜ìƒì œì‘</button>
    <button class="nav-tab" data-tab="legacy">ğŸ“º ê°„í¸ ëª¨ë“œ</button>
    <button class="nav-tab" data-tab="history">ğŸ“ íˆìŠ¤í† ë¦¬</button>
  </div>
  <div class="hdr-status">
    <span class="status-pill"><span class="dot" id="dotOllama"></span><span id="lblOllama">LLM</span></span>
    <span class="status-pill"><span class="dot" id="dotComfy"></span><span id="lblComfy">ComfyUI</span></span>
    <span class="status-pill"><span class="dot" id="dotGpu"></span><span id="lblGpu">GPU</span></span>
    <button class="btn btn-sm btn-secondary" onclick="openSettings()">âš™ï¸</button>
  </div>
</header>

<!-- â•â•â•â•â•â•â• MAIN LAYOUT â•â•â•â•â•â•â• -->
<main class="layout">

  <!-- â•â•â•â•â•â•â• LEFT PANEL â•â•â•â•â•â•â• -->
  <aside class="left-panel">
    <!-- v7 AI VIDEO TAB -->
    <div class="tab-content active" id="tabCreate">
      <!-- Topic Input -->
      <div class="card accent">
        <div class="card-hd"><span class="card-title">ğŸ“ ì£¼ì œ ì…ë ¥</span></div>
        <div class="card-bd">
          <div class="form-group">
            <textarea id="topicInput" rows="2" placeholder="ì˜ˆ: 2026ë…„ AIê°€ ë°”ê¾¸ëŠ” ì¼ìƒ, í™”ì„± íƒì‚¬ ìµœì‹  ê·¼í™©..."></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>ìŠ¤íƒ€ì¼ A</label>
              <select id="styleA"></select>
            </div>
            <div class="form-group">
              <label>ìŠ¤íƒ€ì¼ B</label>
              <select id="styleB"></select>
            </div>
          </div>
          <button class="btn btn-primary btn-full" id="btnGenScenario" onclick="genScenarios()">
            ğŸ­ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± (2ê°œ ë¹„êµ)
          </button>
        </div>
      </div>

      <!-- Output Settings -->
      <div class="card">
        <div class="card-hd"><span class="card-title">ğŸ“ ì¶œë ¥ ì„¤ì •</span></div>
        <div class="card-bd">
          <div class="form-group">
            <label>í”Œë«í¼ í”„ë¦¬ì…‹</label>
            <select id="outputPreset" onchange="updatePresetInfo()"></select>
          </div>
          <div id="presetInfo" style="font-size:9px;color:var(--text3);margin-top:2px"></div>
          <div class="form-row" style="margin-top:6px">
            <div class="form-group">
              <label>í’ˆì§ˆ</label>
              <select id="qualityPreset"></select>
            </div>
            <div class="form-group">
              <label>AI ëª¨ë¸</label>
              <select id="aiModel">
                <option value="framepack">FramePack (ë¹ ë¦„)</option>
                <option value="wan2.1">Wan2.1 14B (ìµœê³ í’ˆì§ˆ)</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Video Settings -->
      <div class="card">
        <div class="card-hd"><span class="card-title">ğŸ™ï¸ ìŒì„± & BGM</span></div>
        <div class="card-bd">
          <div class="form-group">
            <label>TTS ìŒì„±</label>
            <select id="voiceSelect"></select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>ì†ë„</label>
              <select id="ttsSpeed">
                <option value="very_slow">ë§¤ìš° ëŠë¦¼</option>
                <option value="slow">ëŠë¦¼</option>
                <option value="normal" selected>ë³´í†µ</option>
                <option value="fast">ë¹ ë¦„</option>
                <option value="very_fast">ë§¤ìš° ë¹ ë¦„</option>
              </select>
            </div>
            <div class="form-group">
              <label>BGM ë¶„ìœ„ê¸°</label>
              <select id="bgmMood"></select>
            </div>
          </div>
        </div>
      </div>

      <!-- Subtitle Settings -->
      <div class="card">
        <div class="card-hd"><span class="card-title">ğŸ“„ ìë§‰ ì„¤ì •</span></div>
        <div class="card-bd">
          <div class="form-group">
            <label>ìŠ¤íƒ€ì¼ í”„ë¦¬ì…‹</label>
            <select id="subtitleStyle"></select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>ìœ„ì¹˜</label>
              <select id="subtitlePos">
                <option value="top">ìƒë‹¨</option>
                <option value="center">ì¤‘ì•™</option>
                <option value="bottom" selected>í•˜ë‹¨ (ê¸°ë³¸)</option>
              </select>
            </div>
            <div class="form-group">
              <label>í¬ê¸°</label>
              <select id="subtitleSize">
                <option value="24">ì†Œ (24px)</option>
                <option value="36" selected>ì¤‘ (36px)</option>
                <option value="48">ëŒ€ (48px)</option>
                <option value="64">íŠ¹ëŒ€ (64px)</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>ê¸€ììƒ‰</label>
              <select id="subtitleColor">
                <option value="auto">ğŸ¤– Auto (ê°€ë…ì„± ìë™)</option>
                <option value="white">â¬œ í°ìƒ‰</option>
                <option value="black">â¬› ê²€ì •</option>
                <option value="yellow">ğŸŸ¨ ë…¸ë€ìƒ‰</option>
                <option value="custom">ğŸ¨ ì»¤ìŠ¤í…€</option>
              </select>
            </div>
            <div class="form-group hidden" id="customColorWrap">
              <label>ìƒ‰ìƒ ì„ íƒ</label>
              <input type="color" id="customColor" value="#FFFFFF">
            </div>
          </div>
        </div>
      </div>

      <!-- Advanced -->
      <div class="card">
        <div class="card-hd"><span class="card-title">âš¡ ê³ ê¸‰ ì˜µì…˜</span></div>
        <div class="card-bd">
          <div class="form-row">
            <div class="form-group">
              <label>ì¥ë©´ ìˆ˜</label>
              <input type="number" id="numScenes" value="10" min="3" max="20">
            </div>
            <div class="form-group">
              <label>ì´ ê¸¸ì´ (ì´ˆ)</label>
              <input type="number" id="totalDuration" value="40" min="10" max="120">
            </div>
          </div>
          <div class="form-group">
            <label>GPU ê°€ì†</label>
            <select id="useGpu">
              <option value="true" selected>ì‚¬ìš© (NVENC)</option>
              <option value="false">ë¯¸ì‚¬ìš© (CPU)</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- LEGACY TAB -->
    <div class="tab-content" id="tabLegacy">
      <div class="card accent">
        <div class="card-hd"><span class="card-title">ğŸ“º ê°„í¸ ì˜ìƒ ì œì‘</span></div>
        <div class="card-bd">
          <div class="form-group">
            <label>ì£¼ì œ (í•œ ì¤„ì— í•˜ë‚˜ì”©, ìµœëŒ€ 10ê°œ)</label>
            <textarea id="legacyTopics" rows="5" placeholder="ChatGPT 5.0 ì‚¬ìš© í›„ê¸°&#10;RTX 5090 ì„±ëŠ¥&#10;2026 íˆ¬ì í•« ì¢…ëª©"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>ìŒì„±</label>
              <select id="legacyVoice"></select>
            </div>
            <div class="form-group">
              <label>BGM</label>
              <select id="legacyBgm"></select>
            </div>
          </div>
          <button class="btn btn-primary btn-full" id="btnLegacy" onclick="startLegacy()">
            âš¡ ë¹ ë¥¸ ìƒì„± ì‹œì‘
          </button>
        </div>
      </div>
      <div class="card">
        <div class="card-hd"><span class="card-title">ğŸ”¥ íŠ¸ë Œë“œ ì£¼ì œ</span></div>
        <div class="card-bd" id="trendList" style="max-height:300px;overflow-y:auto">
          <div class="empty-state"><div class="es-icon">ğŸ“Š</div>ë¡œë”© ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- HISTORY TAB -->
    <div class="tab-content" id="tabHistory">
      <div class="flex-between" style="margin-bottom:6px">
        <span style="font-size:11px;font-weight:700;color:var(--text2)">ğŸ“ ì‘ì—… íˆìŠ¤í† ë¦¬</span>
        <button class="btn btn-sm btn-danger" onclick="deleteAllJobs()">ğŸ—‘ ì „ì²´ ì‚­ì œ</button>
      </div>
      <div id="jobList">
        <div class="empty-state"><div class="es-icon">ğŸ“‚</div>ì•„ì§ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    </div>
  </aside>

  <!-- â•â•â•â•â•â•â• CENTER PANEL â•â•â•â•â•â•â• -->
  <section class="center-panel">
    <!-- Scenario Comparison -->
    <div id="scenarioSection" class="hidden">
      <div class="card accent">
        <div class="card-hd">
          <span class="card-title">ğŸ­ ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ â€” í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
          <span class="tag" id="scenarioModelTag">LLM</span>
        </div>
        <div class="card-bd">
          <div class="scenario-compare" id="scenarioCompare"></div>
        </div>
      </div>
    </div>

    <!-- Scene Editor -->
    <div id="sceneSection" class="hidden">
      <div class="card">
        <div class="card-hd">
          <span class="card-title">ğŸï¸ ì¥ë©´ í¸ì§‘ (<span id="sceneCount">0</span>ê°œ)</span>
          <div class="btn-group">
            <button class="btn btn-sm btn-secondary" onclick="toggleSceneDetails()">ğŸ“‹ ìƒì„¸ë³´ê¸°</button>
            <button class="btn btn-sm btn-green" onclick="startGeneration()">ğŸš€ ì˜ìƒ ìƒì„± ì‹œì‘</button>
          </div>
        </div>
        <div class="card-bd">
          <div class="scene-list" id="sceneList"></div>
        </div>
      </div>
    </div>

    <!-- Progress Panel -->
    <div id="progressPanel" class="progress-panel">
      <div class="prog-header">
        <span class="prog-title"><span class="spinner"></span> ì˜ìƒ ìƒì„± ì¤‘</span>
        <div>
          <span class="prog-eta" id="progEta">ì˜ˆìƒ ì‹œê°„ ê³„ì‚° ì¤‘...</span>
        </div>
      </div>
      <div class="prog-bar-wrap"><div class="prog-bar" id="progBar"></div></div>
      <div class="prog-body" id="progBody">
        <div style="text-align:center;padding:10px;color:var(--text3);font-size:10px">
          ì¥ë©´ ìƒì„±ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...
        </div>
      </div>
      <div class="prog-gpu" id="progGpu">
        <span>GPU: <span id="pgGpuName">-</span></span>
        <span>VRAM: <span id="pgVram">-</span></span>
        <span>ì˜¨ë„: <span id="pgTemp">-</span></span>
        <span>ì§„í–‰: <span id="pgPct">0%</span></span>
      </div>
    </div>

    <!-- Output Gallery -->
    <div id="gallerySection">
      <div class="card">
        <div class="card-hd">
          <span class="card-title">ğŸ¬ ì™„ì„± ì˜ìƒ</span>
          <span class="tag green" id="galleryCount">0ê°œ</span>
        </div>
        <div class="card-bd">
          <div class="gallery" id="gallery">
            <div class="empty-state">
              <div class="es-icon">ğŸ¬</div>
              ì•„ì§ ìƒì„±ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤<br>
              <span style="font-size:9px;color:var(--text3)">ì£¼ì œë¥¼ ì…ë ¥í•˜ê³  ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒì„±í•´ë³´ì„¸ìš”</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty welcome state -->
    <div id="welcomeState" class="card" style="flex:1;display:flex;align-items:center;justify-content:center;min-height:300px">
      <div class="empty-state">
        <div class="es-icon" style="font-size:42px">ğŸ¬</div>
        <div style="font-size:16px;font-weight:700;margin:10px 0;color:var(--text1)">AI Shorts Studio PRO v1.0.0</div>
        <div style="font-size:9px;color:var(--text3);margin-bottom:6px">Â© chally.choi</div>
        <div style="font-size:11px;color:var(--text2);line-height:1.8">
          ComfyUI + FramePack/Wan2.1 AI ì˜ìƒ ìƒì„± ì—”ì§„<br>
          ì‹œë‚˜ë¦¬ì˜¤ â†’ ì¥ë©´ ë¶„ì„ â†’ ì˜ë¬¸ í”„ë¡¬í”„íŠ¸ â†’ AI ì˜ìƒ â†’ ìë§‰+BGM â†’ MP4<br><br>
          <span class="tag">10 ì¥ë©´</span>
          <span class="tag purple">40ì´ˆ</span>
          <span class="tag orange">RTX 3090</span>
          <span class="tag green">NVENC</span>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â• RIGHT PANEL â•â•â•â•â•â•â• -->
  <aside class="right-panel">
    <!-- System Monitor -->
    <div class="card">
      <div class="card-hd"><span class="card-title">ğŸ“Š ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°</span></div>
      <div class="card-bd" style="font-size:10px;font-family:'JetBrains Mono',monospace">
        <div class="flex-between mb-4"><span class="text-muted">CPU</span><span id="sysC">-</span></div>
        <div class="flex-between mb-4"><span class="text-muted">RAM</span><span id="sysR">-</span></div>
        <div class="flex-between mb-4"><span class="text-muted">GPU</span><span id="sysG">-</span></div>
        <div class="flex-between mb-4"><span class="text-muted">VRAM</span><span id="sysV">-</span></div>
        <div class="flex-between mb-4"><span class="text-muted">ì˜¨ë„</span><span id="sysT">-</span></div>
        <div class="flex-between mb-4"><span class="text-muted">ì „ë ¥</span><span id="sysP">-</span></div>
        <div class="flex-between mb-4"><span class="text-muted">ë””ìŠ¤í¬</span><span id="sysD">-</span></div>
        <div class="flex-between mb-4"><span class="text-muted">WSL2</span><span id="sysW">-</span></div>
        <div class="flex-between"><span class="text-muted">ComfyUI</span><span id="sysCU">-</span></div>
      </div>
    </div>

    <!-- LLM Info -->
    <div class="card">
      <div class="card-hd">
        <span class="card-title">ğŸ¤– AI ì—”ì§„</span>
        <button class="btn btn-sm btn-secondary" onclick="refreshModels()">ğŸ”„</button>
      </div>
      <div class="card-bd">
        <div class="form-group">
          <label>Ollama ëª¨ë¸</label>
          <select id="modelSelect" onchange="switchModel()"></select>
        </div>
        <div id="modelInfo" style="font-size:9px;color:var(--text3)"></div>
      </div>
    </div>

    <!-- Active Jobs / Pipeline Progress -->
    <div class="card" id="activeJobsCard">
      <div class="card-hd">
        <span class="card-title">âš¡ ì‘ì—… ì§„í–‰</span>
        <span class="tag" id="jobStatusTag" style="display:none">ì§„í–‰ì¤‘</span>
      </div>
      <div class="card-bd" id="activeJobsBody">
        <div class="empty-state" style="padding:10px"><div class="es-icon">âœ¨</div>ëŒ€ê¸° ì¤‘</div>
      </div>
    </div>

    <!-- ComfyUI Log Console -->
    <div class="card" id="comfyLogCard">
      <div class="card-hd">
        <span class="card-title">ğŸ¨ ComfyUI ë¡œê·¸</span>
        <div style="display:flex;gap:4px">
          <button class="btn btn-sm btn-secondary" onclick="clearComfyLogs()" title="ë¡œê·¸ ì§€ìš°ê¸°">ğŸ—‘</button>
          <button class="btn btn-sm btn-secondary" onclick="fetchComfyLogs()" title="ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
        </div>
      </div>
      <div class="card-bd" style="padding:0">
        <div id="comfyLogConsole" style="
          height:200px;overflow-y:auto;padding:6px 8px;
          font-family:'JetBrains Mono',monospace;font-size:9.5px;line-height:1.6;
          background:var(--void);border-radius:0 0 var(--radius) var(--radius);
        ">
          <div class="comfy-log-line" style="color:var(--text3)">ComfyUI ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
      </div>
    </div>

    <!-- Quick Links -->
    <div class="card">
      <div class="card-hd"><span class="card-title">ğŸ”— ë¹ ë¥¸ ë§í¬</span></div>
      <div class="card-bd" style="display:flex;flex-direction:column;gap:3px">
        <a href="/api/health" target="_blank" style="font-size:10px">ğŸ©º Health Check</a>
        <a href="/api/version" target="_blank" style="font-size:10px">ğŸ“¦ Version Info</a>
        <a href="/api/gpu" target="_blank" style="font-size:10px">ğŸ–¥ï¸ GPU Status</a>
        <a href="/api/comfyui/status" target="_blank" style="font-size:10px">ğŸ¨ ComfyUI Status</a>
      </div>
    </div>
  </aside>
</main>

<!-- â•â•â•â•â•â•â• SETTINGS MODAL â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal">
    <div class="modal-hd">
      <h3>âš™ï¸ ì„¤ì •</h3>
      <button class="modal-close" onclick="closeSettings()">&times;</button>
    </div>
    <div class="modal-bd">
      <div class="modal-tabs">
        <button class="modal-tab active" data-stab="general">ì¼ë°˜</button>
        <button class="modal-tab" data-stab="social">ì†Œì…œ ë¯¸ë””ì–´</button>
        <button class="modal-tab" data-stab="comfyui">ComfyUI</button>
        <button class="modal-tab" data-stab="update">ì—…ë°ì´íŠ¸</button>
        <button class="modal-tab" data-stab="help">ë„ì›€ë§</button>
      </div>

      <!-- General Settings -->
      <div class="settings-section active" id="stabGeneral">
        <h4>ğŸ‘¤ ì‚¬ìš©ì í”„ë¡œí•„</h4>
        <div class="settings-row">
          <label>ë‹‰ë„¤ì„</label>
          <div class="input-wrap">
            <input type="text" id="setUsername" placeholder="ë‚˜ì˜ ì±„ë„ëª…">
          </div>
        </div>
        <div class="settings-row">
          <label>ì•„ë°”íƒ€ URL</label>
          <div class="input-wrap">
            <input type="text" id="setAvatar" placeholder="https://example.com/avatar.png">
            <div class="settings-hint">í”„ë¡œí•„ ì´ë¯¸ì§€ URL (ì„ íƒì‚¬í•­)</div>
          </div>
        </div>
        <h4>ğŸ¬ ê¸°ë³¸ ì˜ìƒ ì„¤ì •</h4>
        <div class="settings-row">
          <label>ê¸°ë³¸ í”„ë¦¬ì…‹</label>
          <div class="input-wrap"><select id="setDefaultPreset"></select></div>
        </div>
        <div class="settings-row">
          <label>ê¸°ë³¸ ìŒì„±</label>
          <div class="input-wrap"><select id="setDefaultVoice"></select></div>
        </div>
        <div class="settings-row">
          <label>ê¸°ë³¸ í’ˆì§ˆ</label>
          <div class="input-wrap">
            <select id="setDefaultQuality">
              <option value="balance">ë°¸ëŸ°ìŠ¤ (480p+ì—…ìŠ¤ì¼€ì¼)</option>
              <option value="ultra">ìµœê³ í’ˆì§ˆ (720p ì§ì ‘)</option>
            </select>
          </div>
        </div>
        <div style="margin-top:12px;text-align:right">
          <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ ì €ì¥</button>
        </div>
      </div>

      <!-- Social Media Settings -->
      <div class="settings-section" id="stabSocial">
        <h4>ğŸ“º YouTube API</h4>
        <div class="settings-row">
          <label>API Key</label>
          <div class="input-wrap">
            <input type="text" id="setYtApiKey" placeholder="AIza...">
            <div class="settings-hint">YouTube Data API v3 í‚¤ (<a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a>)</div>
          </div>
        </div>
        <div class="settings-row">
          <label>OAuth Client</label>
          <div class="input-wrap">
            <input type="text" id="setYtOauth" placeholder="Client ID">
            <div class="settings-hint">ë™ì˜ìƒ ì—…ë¡œë“œì— í•„ìš”í•œ OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ ID</div>
          </div>
        </div>
        <h4>ğŸ“± Instagram</h4>
        <div class="settings-row">
          <label>Access Token</label>
          <div class="input-wrap">
            <input type="text" id="setIgToken" placeholder="IGQ...">
            <div class="settings-hint">Instagram Graph API ì•¡ì„¸ìŠ¤ í† í°</div>
          </div>
        </div>
        <h4>ğŸ¦ X (Twitter)</h4>
        <div class="settings-row">
          <label>Bearer Token</label>
          <div class="input-wrap">
            <input type="text" id="setXToken" placeholder="AAAA...">
            <div class="settings-hint">X API v2 Bearer Token</div>
          </div>
        </div>
        <h4>ğŸµ TikTok</h4>
        <div class="settings-row">
          <label>Access Token</label>
          <div class="input-wrap">
            <input type="text" id="setTikToken" placeholder="">
            <div class="settings-hint">TikTok Content Posting API í† í°</div>
          </div>
        </div>
        <div style="margin-top:12px;text-align:right">
          <button class="btn btn-primary" onclick="saveSocialSettings()">ğŸ’¾ ì €ì¥</button>
        </div>
      </div>

      <!-- ComfyUI Settings -->
      <div class="settings-section" id="stabComfyui">
        <h4>ğŸ¨ ComfyUI ì—°ê²°</h4>
        <div class="settings-row">
          <label>ComfyUI Host</label>
          <div class="input-wrap">
            <input type="text" id="setComfyHost" placeholder="http://127.0.0.1:8188">
            <div class="settings-hint">ë¡œì»¬ ComfyUI ì„œë²„ ì£¼ì†Œ (ê¸°ë³¸: http://127.0.0.1:8188)</div>
          </div>
        </div>
        <div class="settings-row">
          <label>ìƒíƒœ</label>
          <div class="input-wrap">
            <span id="comfyStatus" style="font-size:11px">í™•ì¸ ì¤‘...</span>
          </div>
        </div>
        <h4>ğŸ¤– Ollama ì„¤ì •</h4>
        <div class="settings-row">
          <label>Ollama Host</label>
          <div class="input-wrap">
            <input type="text" id="setOllamaHost" placeholder="http://localhost:11434">
          </div>
        </div>
        <div class="settings-row">
          <label>ê¸°ë³¸ ëª¨ë¸</label>
          <div class="input-wrap">
            <input type="text" id="setOllamaModel" placeholder="exaone3.5:32b">
          </div>
        </div>
        <div style="margin-top:12px;text-align:right">
          <button class="btn btn-secondary" onclick="checkComfyUI()">ğŸ” ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        </div>
      </div>

      <!-- Update Settings -->
      <div class="settings-section" id="stabUpdate">
        <h4>ğŸ”„ ì†Œí”„íŠ¸ì›¨ì–´ ì—…ë°ì´íŠ¸</h4>
        <div style="padding:10px;background:var(--deep);border-radius:8px;margin-bottom:10px">
          <div class="flex-between">
            <span style="font-size:11px">í˜„ì¬ ë²„ì „</span>
            <span class="tag green" id="setCurrentVer">v1.0.0</span>
          </div>
        </div>
        <button class="btn btn-primary btn-full" onclick="checkUpdate()">ğŸ” ì—…ë°ì´íŠ¸ í™•ì¸</button>
        <div id="updateResult" style="margin-top:10px;font-size:11px;color:var(--text2)"></div>
        <div class="divider"></div>
        <h4>ğŸ“‹ ë³€ê²½ì‚¬í•­ (v1.0.0)</h4>
        <div style="font-size:10px;color:var(--text2);line-height:1.6">
          â€¢ ComfyUI + FramePack/Wan2.1 AI ì˜ìƒ ìƒì„± ì—”ì§„ í†µí•©<br>
          â€¢ ì‹œë‚˜ë¦¬ì˜¤ 2ê°œ ë¹„êµ í›„ ì„ íƒ ê¸°ëŠ¥<br>
          â€¢ ì¥ë©´ë³„ ìƒì„¸ ì„¤ëª… (êµ¬ë„/ì¹´ë©”ë¼/ì¡°ëª…/í–‰ë™/ë°°ê²½/ë¶„ìœ„ê¸°)<br>
          â€¢ í•œêµ­ì–´ â†’ ì˜ë¬¸ í”„ë¡¬í”„íŠ¸ ìë™ ë³€í™˜<br>
          â€¢ í”Œë«í¼ë³„ ì¶œë ¥ í¬ë§· í”„ë¦¬ì…‹ (ìœ íŠœë¸Œ/ì¸ìŠ¤íƒ€/í‹±í†¡/X)<br>
          â€¢ ìë§‰ ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ + Auto ëª¨ë“œ<br>
          â€¢ ì‹¤ì‹œê°„ ETA í‘œì‹œ ë° GPU ëª¨ë‹ˆí„°ë§<br>
          â€¢ <b>ComfyUI ì‹¤ì‹œê°„ ë¡œê·¸ ì½˜ì†” (UI ìš°ì¸¡)</b><br>
          â€¢ <b>start.sh í†µí•© ì‹¤í–‰ (ComfyUI + Flask í•œë°©)</b><br>
          â€¢ <b>ë™ì  ì²´í¬í¬ì¸íŠ¸ ê°ì§€ (í•˜ë“œì½”ë”© ì œê±°)</b><br>
          â€¢ ì˜ìƒ ê°œë³„/ì „ì²´ ì‚­ì œ ê¸°ëŠ¥<br>
          â€¢ ì„¤ì • íŒ¨ë„ (ì†Œì…œ API, í”„ë¡œí•„, ComfyUI)<br>
          â€¢ 480p ìƒì„± â†’ AI ì—…ìŠ¤ì¼€ì¼ / 720p ì§ì ‘ ìƒì„± ì„ íƒ<br>
          â€¢ <b>Â© chally.choi</b>
        </div>
      </div>

      <!-- Help -->
      <div class="settings-section" id="stabHelp">
        <h4>ğŸ“– ì‚¬ìš© ê°€ì´ë“œ</h4>
        <div style="font-size:10.5px;color:var(--text2);line-height:1.7">
          <b>1. AI ì˜ìƒ ì œì‘</b><br>
          &nbsp;&nbsp;â‘  ì£¼ì œ ì…ë ¥ â†’ ì‹œë‚˜ë¦¬ì˜¤ ìŠ¤íƒ€ì¼ 2ê°œ ì„ íƒ<br>
          &nbsp;&nbsp;â‘¡ "ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±" í´ë¦­ â†’ 2ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ<br>
          &nbsp;&nbsp;â‘¢ ì›í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ â†’ ì¥ë©´ë³„ í¸ì§‘ ê°€ëŠ¥<br>
          &nbsp;&nbsp;â‘£ ì¶œë ¥ í¬ë§·/í’ˆì§ˆ/ìë§‰ ì„¤ì • í™•ì¸<br>
          &nbsp;&nbsp;â‘¤ "ì˜ìƒ ìƒì„± ì‹œì‘" â†’ ì‹¤ì‹œê°„ ì§„í–‰ë¥  í™•ì¸<br>
          &nbsp;&nbsp;â‘¥ ìš°ì¸¡ "ì‘ì—… ì§„í–‰" + "ComfyUI ë¡œê·¸" íŒ¨ë„ì—ì„œ ëª¨ë‹ˆí„°ë§<br><br>
          <b>2. ê°„í¸ ëª¨ë“œ (ìŠ¬ë¼ì´ë“œì‡¼)</b><br>
          &nbsp;&nbsp;â‘  ì£¼ì œë¥¼ í•œ ì¤„ì— í•˜ë‚˜ì”© ì…ë ¥<br>
          &nbsp;&nbsp;â‘¡ "ë¹ ë¥¸ ìƒì„± ì‹œì‘" í´ë¦­<br>
          &nbsp;&nbsp;â‘¢ ìŠ¬ë¼ì´ë“œì‡¼+TTS ë°©ì‹ìœ¼ë¡œ ë¹ ë¥´ê²Œ ìƒì„±<br><br>
          <b>3. ComfyUI ì„¤ì¹˜ (ê³ í’ˆì§ˆ AI ì˜ìƒ í•„ìˆ˜)</b><br>
          &nbsp;&nbsp;â‘  WSL2ì—ì„œ: <code style="background:var(--deep);padding:1px 4px;border-radius:3px">./install.sh comfyui</code><br>
          &nbsp;&nbsp;â‘¡ ìë™ìœ¼ë¡œ ComfyUI + FramePack + Wan2.1 ì„¤ì¹˜<br>
          &nbsp;&nbsp;â‘¢ <b>ì²´í¬í¬ì¸íŠ¸ ëª¨ë¸ í•„ìˆ˜!</b> ComfyUI/models/checkpoints/ ì— SDXL ë“± ëª¨ë¸ íŒŒì¼ì„ ë„£ì–´ì•¼ ì´ë¯¸ì§€ ìƒì„± ê°€ëŠ¥<br>
          &nbsp;&nbsp;â‘£ start.shê°€ ComfyUIë„ í•¨ê»˜ ì‹¤í–‰í•©ë‹ˆë‹¤<br><br>
          <b>4. í•«í‚¤</b><br>
          &nbsp;&nbsp;Ctrl+Enter: ìƒì„± ì‹œì‘ / Esc: ëª¨ë‹¬ ë‹«ê¸°
        </div>
        <div class="divider"></div>
        <h4>â“ FAQ</h4>
        <div style="font-size:10.5px;color:var(--text2);line-height:1.7">
          <b>Q: ComfyUI ì—†ì´ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜ìš”?</b><br>
          A: ë„¤! ComfyUI ì—†ì´ëŠ” ìŠ¬ë¼ì´ë“œì‡¼ ë°©ì‹(v6 í´ë°±)ìœ¼ë¡œ ì˜ìƒì´ ìƒì„±ë©ë‹ˆë‹¤. AI ì˜ìƒì„ ì›í•˜ë©´ ComfyUIë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”.<br><br>
          <b>Q: "ì²´í¬í¬ì¸íŠ¸ ì—†ìŒ" ì—ëŸ¬ê°€ ë‚˜ìš”</b><br>
          A: ComfyUI/models/checkpoints/ í´ë”ì— SDXL ë“±ì˜ ì²´í¬í¬ì¸íŠ¸ ëª¨ë¸ íŒŒì¼(.safetensors)ì„ ë„£ì–´ì•¼ í•©ë‹ˆë‹¤. ì„¤ì • > ComfyUI íƒ­ì—ì„œ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œ ì²´í¬í¬ì¸íŠ¸ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.<br><br>
          <b>Q: ì˜ìƒ í•˜ë‚˜ ë§Œë“œëŠ”ë° ì–¼ë§ˆë‚˜ ê±¸ë¦¬ë‚˜ìš”?</b><br>
          A: RTX 3090 ê¸°ì¤€ â€” ë°¸ëŸ°ìŠ¤ ëª¨ë“œ: ~40ë¶„ / ìµœê³ í’ˆì§ˆ: ~100ë¶„ (10ì¥ë©´ ê¸°ì¤€)<br><br>
          <b>Q: ì–´ë–¤ GPUê°€ í•„ìš”í•œê°€ìš”?</b><br>
          A: ìµœì†Œ 12GB VRAM (RTX 3060 ì´ìƒ), ê¶Œì¥ 24GB (RTX 3090/4090)
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• JAVASCRIPT â•â•â•â•â•â•â• -->
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S = {
  socket: null,
  scenarios: null,
  selectedScenario: null,
  selectedScenes: [],
  currentJobId: null,
  showSceneDetails: false,
  presets: {},
  subtitleStyles: {},
  subtitleColors: {},
  qualityPresets: {},
  scenarioStyles: {},
  bgmMoods: {},
  voices: [],
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  initSocket();
  initTabs();
  initModalTabs();
  loadPresets();
  loadVoices();
  loadJobs();
  loadTrends();
  initKeyboard();
  setInterval(refreshMetrics, 5000);
  loadSettings();
  fetchComfyLogs();

  // color picker toggle
  document.getElementById('subtitleColor').addEventListener('change', e => {
    document.getElementById('customColorWrap').classList.toggle('hidden', e.target.value !== 'custom');
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SOCKET.IO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initSocket() {
  S.socket = io({ transports: ['websocket', 'polling'] });

  S.socket.on('connected', data => {
    setDot('dotOllama', data.ollama);
    document.getElementById('lblOllama').textContent = data.ollama ? 'Ollama' : 'Ollama âœ—';
    setDot('dotComfy', data.comfyui);
    document.getElementById('lblComfy').textContent = data.comfyui ? 'ComfyUI' : 'ComfyUI âœ—';
    setDot('dotGpu', !!data.gpu && data.gpu !== 'N/A');
    document.getElementById('lblGpu').textContent = data.gpu || 'GPU';
    document.getElementById('verLabel').textContent = 'v' + data.version;
  });

  S.socket.on('job_update', data => {
    updateJobInList(data);
    if (data.id === S.currentJobId) {
      updateProgress(data);
      updateActiveJobPanel(data);
    }
  });

  S.socket.on('pipeline_step', data => {
    if (data.job_id === S.currentJobId) {
      updateProgressStep(data);
      updateActiveJobPanel(data);
    }
  });

  S.socket.on('eta_update', data => {
    if (data.job_id === S.currentJobId) {
      updateETA(data);
    }
  });

  S.socket.on('scenarios_ready', data => {
    if (data.job_id === S.currentJobId) {
      displayScenarios(data.scenarios);
    }
  });

  S.socket.on('job_completed', data => {
    if (data.job_id === S.currentJobId) {
      onJobComplete(data);
    }
    loadJobs();
  });

  S.socket.on('metrics', data => {
    renderMetrics(data);
  });

  S.socket.on('comfyui_log', data => {
    appendComfyLog(data);
  });

  S.socket.on('comfyui_status', data => {
    if (data.success) {
      setDot('dotComfy', true);
      document.getElementById('lblComfy').textContent = 'ComfyUI';
    }
  });
}

function setDot(id, ok) {
  const el = document.getElementById(id);
  el.className = 'dot ' + (ok ? 'ok' : 'err');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initTabs() {
  document.querySelectorAll('.nav-tab').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
      const target = document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1));
      if (target) target.classList.add('active');
    });
  });
}

function initModalTabs() {
  document.querySelectorAll('.modal-tab').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.modal-tab').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
      const target = document.getElementById('stab' + btn.dataset.stab.charAt(0).toUpperCase() + btn.dataset.stab.slice(1));
      if (target) target.classList.add('active');
    });
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOAD PRESETS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadPresets() {
  try {
    const [presets, subStyles, quality, scStyles, moods] = await Promise.all([
      fetch('/api/output-presets').then(r => r.json()),
      fetch('/api/subtitle-styles').then(r => r.json()),
      fetch('/api/quality-presets').then(r => r.json()),
      fetch('/api/scenario-styles').then(r => r.json()),
      fetch('/api/bgm-moods').then(r => r.json()),
    ]);

    S.presets = presets.presets || {};
    S.subtitleStyles = subStyles.styles || {};
    S.subtitleColors = subStyles.colors || {};
    S.qualityPresets = quality.presets || {};
    S.scenarioStyles = scStyles.styles || {};
    S.bgmMoods = moods.moods || {};

    // Populate output presets
    const op = document.getElementById('outputPreset');
    op.innerHTML = '';
    for (const [k, v] of Object.entries(S.presets)) {
      op.innerHTML += `<option value="${k}">${v.icon} ${v.name} (${v.ratio})</option>`;
    }
    // Also for settings
    const sp = document.getElementById('setDefaultPreset');
    if (sp) { sp.innerHTML = op.innerHTML; }

    updatePresetInfo();

    // Quality presets
    const qp = document.getElementById('qualityPreset');
    qp.innerHTML = '';
    for (const [k, v] of Object.entries(S.qualityPresets)) {
      qp.innerHTML += `<option value="${k}">${v.icon} ${v.name}</option>`;
    }

    // Subtitle styles
    const ss = document.getElementById('subtitleStyle');
    ss.innerHTML = '';
    for (const [k, v] of Object.entries(S.subtitleStyles)) {
      ss.innerHTML += `<option value="${k}">${v.name} â€” ${v.desc}</option>`;
    }

    // Scenario styles
    const sa = document.getElementById('styleA');
    const sb = document.getElementById('styleB');
    sa.innerHTML = ''; sb.innerHTML = '';
    for (const [k, v] of Object.entries(S.scenarioStyles)) {
      sa.innerHTML += `<option value="${k}" ${k==='emotional'?'selected':''}>${v.icon} ${v.name}</option>`;
      sb.innerHTML += `<option value="${k}" ${k==='humor'?'selected':''}>${v.icon} ${v.name}</option>`;
    }

    // BGM moods
    const bm = document.getElementById('bgmMood');
    const lb = document.getElementById('legacyBgm');
    bm.innerHTML = ''; if(lb) lb.innerHTML = '';
    for (const [k, v] of Object.entries(S.bgmMoods)) {
      const opt = `<option value="${k}">${v.icon} ${v.name}</option>`;
      bm.innerHTML += opt;
      if (lb) lb.innerHTML += opt;
    }
  } catch (e) {
    console.error('Failed to load presets:', e);
  }
}

async function loadVoices() {
  try {
    const data = await fetch('/api/voices').then(r => r.json());
    S.voices = data.voices || [];
    const selects = ['voiceSelect', 'legacyVoice', 'setDefaultVoice'];
    selects.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.innerHTML = '';
      S.voices.forEach(v => {
        el.innerHTML += `<option value="${v.id}">${v.name}</option>`;
      });
    });
  } catch (e) {
    console.error('Failed to load voices:', e);
  }
}

function updatePresetInfo() {
  const sel = document.getElementById('outputPreset').value;
  const p = S.presets[sel];
  if (p) {
    document.getElementById('presetInfo').textContent =
      `${p.width}Ã—${p.height} | ${p.fps}fps | ${p.ratio}` +
      (p.max_duration > 0 ? ` | ìµœëŒ€ ${p.max_duration}ì´ˆ` : '');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCENARIO GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function genScenarios() {
  const topic = document.getElementById('topicInput').value.trim();
  if (!topic) return alert('ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');

  const btn = document.getElementById('btnGenScenario');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì¤‘...';

  document.getElementById('welcomeState').classList.add('hidden');
  document.getElementById('scenarioSection').classList.remove('hidden');
  document.getElementById('scenarioCompare').innerHTML =
    '<div class="empty-state" style="grid-column:1/-1"><span class="spinner"></span> AIê°€ 2ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';

  try {
    const resp = await fetch('/api/scenarios', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        topic,
        num_scenes: parseInt(document.getElementById('numScenes').value) || 10,
        duration: parseInt(document.getElementById('totalDuration').value) || 40,
        style_a: document.getElementById('styleA').value,
        style_b: document.getElementById('styleB').value,
      }),
    });
    const data = await resp.json();
    if (data.error) throw new Error(data.error);
    displayScenarios(data.scenarios);
  } catch (e) {
    document.getElementById('scenarioCompare').innerHTML =
      `<div class="empty-state text-red" style="grid-column:1/-1">âŒ ${e.message}</div>`;
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'ğŸ­ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± (2ê°œ ë¹„êµ)';
  }
}

function displayScenarios(scenarios) {
  S.scenarios = scenarios;
  const container = document.getElementById('scenarioCompare');

  const modelUsed = scenarios.scenario_a?.model_used || 'template';
  document.getElementById('scenarioModelTag').textContent = modelUsed === 'template' ? 'í…œí”Œë¦¿' : modelUsed;

  container.innerHTML = '';

  ['a', 'b'].forEach(key => {
    const sc = scenarios[`scenario_${key}`];
    if (!sc) return;

    const preview = sc.scenes.slice(0, 3).map(s => s.narration).join(' ').substring(0, 150);

    container.innerHTML += `
      <div class="scenario-card" id="sc-${key}" onclick="selectScenario('${key}')">
        <span class="sc-badge">ì‹œë‚˜ë¦¬ì˜¤ ${key.toUpperCase()}</span>
        <div class="sc-style">${sc.style_icon} ${sc.style_name}</div>
        <div class="sc-preview">${preview}...</div>
        <div style="margin-top:6px;display:flex;gap:4px">
          <span class="tag">${sc.scene_count}ì¥ë©´</span>
          <span class="tag purple">${sc.model_used === 'template' ? 'í…œí”Œë¦¿' : 'AI'}</span>
        </div>
      </div>
    `;
  });
}

function selectScenario(key) {
  S.selectedScenario = key;

  document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('selected'));
  document.getElementById(`sc-${key}`).classList.add('selected');

  const sc = S.scenarios[`scenario_${key}`];
  S.selectedScenes = JSON.parse(JSON.stringify(sc.scenes)); // deep copy

  document.getElementById('sceneSection').classList.remove('hidden');
  renderScenes();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCENE EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderScenes() {
  const list = document.getElementById('sceneList');
  const count = document.getElementById('sceneCount');
  count.textContent = S.selectedScenes.length;

  list.innerHTML = '';
  S.selectedScenes.forEach((scene, i) => {
    const dur = (parseInt(document.getElementById('totalDuration').value) || 40) / S.selectedScenes.length;
    const details = S.showSceneDetails ? `
      <div class="si-details">
        <span>ğŸ“ ${scene.composition || '-'}</span>
        <span>ğŸ¥ ${scene.camera || '-'}</span>
        <span>ğŸ’¡ ${scene.lighting || '-'}</span>
        <span>ğŸ­ ${scene.action || '-'}</span>
        <span>ğŸ”ï¸ ${scene.background || '-'}</span>
        <span>âœ¨ ${scene.mood || '-'}</span>
      </div>
      <textarea onchange="updateScene(${i},'narration',this.value)"
        placeholder="ë‚˜ë ˆì´ì…˜ í¸ì§‘">${scene.narration || ''}</textarea>
    ` : '';

    list.innerHTML += `
      <div class="scene-item">
        <div class="si-head">
          <span class="si-num">SCENE ${scene.scene_num || i + 1}</span>
          <span class="si-dur">${dur.toFixed(1)}s</span>
        </div>
        <div class="si-narr">${scene.narration || '(ë¹„ì–´ìˆìŒ)'}</div>
        ${details}
      </div>
    `;
  });
}

function toggleSceneDetails() {
  S.showSceneDetails = !S.showSceneDetails;
  renderScenes();
}

function updateScene(idx, field, value) {
  if (S.selectedScenes[idx]) {
    S.selectedScenes[idx][field] = value;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  START GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function startGeneration() {
  if (!S.selectedScenes.length) return alert('ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”');

  const topic = document.getElementById('topicInput').value.trim();
  const options = gatherOptions();

  document.getElementById('progressPanel').classList.add('active');
  document.getElementById('progBar').style.width = '0%';
  document.getElementById('progEta').textContent = 'ì˜ˆìƒ ì‹œê°„ ê³„ì‚° ì¤‘...';
  initProgressBody(S.selectedScenes.length);

  try {
    const resp = await fetch('/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        topic,
        mode: 'v7',
        options: {
          ...options,
          auto_select: S.selectedScenario,
          style_a: document.getElementById('styleA').value,
          style_b: document.getElementById('styleB').value,
        },
      }),
    });
    const data = await resp.json();
    if (data.error) throw new Error(data.error);
    S.currentJobId = data.job_id;
  } catch (e) {
    alert('ìƒì„± ì‹¤íŒ¨: ' + e.message);
    document.getElementById('progressPanel').classList.remove('active');
  }
}

async function startLegacy() {
  const text = document.getElementById('legacyTopics').value.trim();
  if (!text) return alert('ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');

  const topics = text.split('\n').map(l => l.trim()).filter(Boolean).slice(0, 10);
  if (!topics.length) return alert('ìœ íš¨í•œ ì£¼ì œê°€ ì—†ìŠµë‹ˆë‹¤');

  const btn = document.getElementById('btnLegacy');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> ìƒì„± ì¤‘...';

  document.getElementById('progressPanel').classList.add('active');

  try {
    const resp = await fetch('/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        topics,
        mode: 'legacy',
        options: {
          voice: document.getElementById('legacyVoice')?.value || 'ko-KR-SunHiNeural',
          bgm_mood: document.getElementById('legacyBgm')?.value || 'none',
          output_preset: 'youtube_shorts',
          use_gpu: true,
        },
      }),
    });
    const data = await resp.json();
    if (data.error) throw new Error(data.error);
    S.currentJobId = data.job_id;
  } catch (e) {
    alert('ìƒì„± ì‹¤íŒ¨: ' + e.message);
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'âš¡ ë¹ ë¥¸ ìƒì„± ì‹œì‘';
  }
}

function gatherOptions() {
  const colorMode = document.getElementById('subtitleColor').value;
  return {
    num_scenes: parseInt(document.getElementById('numScenes').value) || 10,
    duration: parseInt(document.getElementById('totalDuration').value) || 40,
    output_preset: document.getElementById('outputPreset').value,
    quality: document.getElementById('qualityPreset').value,
    ai_model: document.getElementById('aiModel').value,
    voice: document.getElementById('voiceSelect').value,
    tts_speed: document.getElementById('ttsSpeed').value,
    bgm_mood: document.getElementById('bgmMood').value,
    use_gpu: document.getElementById('useGpu').value === 'true',
    subtitle: {
      style: document.getElementById('subtitleStyle').value,
      position: document.getElementById('subtitlePos').value,
      font_size: parseInt(document.getElementById('subtitleSize').value) || 36,
      color_mode: colorMode,
      color: colorMode === 'custom' ? document.getElementById('customColor').value : '#FFFFFF',
    },
    scene_duration: (parseInt(document.getElementById('totalDuration').value) || 40) /
      (parseInt(document.getElementById('numScenes').value) || 10),
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROGRESS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initProgressBody(numScenes) {
  const body = document.getElementById('progBody');
  body.innerHTML = '';
  for (let i = 0; i < numScenes; i++) {
    body.innerHTML += `
      <div class="prog-scene" id="ps-${i}">
        <span class="ps-num">Scene ${i + 1}</span>
        <span class="ps-status">ëŒ€ê¸°</span>
        <span class="ps-time">-</span>
      </div>
    `;
  }
}

function updateProgress(data) {
  const pct = data.progress || 0;
  document.getElementById('progBar').style.width = pct + '%';
  document.getElementById('pgPct').textContent = pct + '%';

  if (data.current_step) {
    // Update active scene in progress list
    const match = data.current_step.match(/Scene (\d+)/);
    if (match) {
      const idx = parseInt(match[1]) - 1;
      document.querySelectorAll('.prog-scene').forEach((el, i) => {
        el.classList.remove('active', 'done');
        if (i < idx) el.classList.add('done');
        else if (i === idx) el.classList.add('active');
      });
    }
  }
}

function updateProgressStep(data) {
  const pct = data.progress || 0;
  document.getElementById('progBar').style.width = pct + '%';
  document.getElementById('pgPct').textContent = pct + '%';
}

function updateETA(data) {
  const eta = document.getElementById('progEta');
  eta.textContent = `${data.eta_formatted} ë‚¨ìŒ (ì™„ë£Œ ~${data.estimated_completion})`;

  // Update scene progress
  for (let i = 0; i < data.scenes_done; i++) {
    const el = document.getElementById(`ps-${i}`);
    if (el) {
      el.classList.remove('active');
      el.classList.add('done');
      el.querySelector('.ps-status').textContent = 'ì™„ë£Œ';
    }
  }
  if (data.scenes_done < data.scenes_total) {
    const active = document.getElementById(`ps-${data.scenes_done}`);
    if (active) {
      active.classList.add('active');
      active.querySelector('.ps-status').textContent = 'ìƒì„± ì¤‘';
    }
  }

  document.getElementById('pgGpuName').textContent = gpu_name || '-';

  // Update right panel ETA
  const etaEl = document.getElementById('activeJobEta');
  if (etaEl) {
    etaEl.innerHTML = `â± ${data.eta_formatted} ë‚¨ìŒ | ${data.scenes_done}/${data.scenes_total} ì¥ë©´ ì™„ë£Œ`;
  }
  const scenesEl = document.getElementById('activeJobScenes');
  if (scenesEl) {
    let html = '';
    for (let i = 0; i < data.scenes_total; i++) {
      const icon = i < data.scenes_done ? 'âœ…' : (i === data.scenes_done ? 'ğŸ”„' : 'â³');
      html += `<span style="margin-right:4px">${icon} S${i+1}</span>`;
    }
    scenesEl.innerHTML = html;
  }
}

let gpu_name = '-';

function onJobComplete(data) {
  document.getElementById('progressPanel').classList.remove('active');
  S.currentJobId = null;
  resetActiveJobPanel();

  if (data.outputs && data.outputs.length > 0) {
    renderGallery(data.outputs);
  }
  loadJobs();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GALLERY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGallery(outputs) {
  const g = document.getElementById('gallery');
  document.getElementById('galleryCount').textContent = outputs.length + 'ê°œ';

  g.innerHTML = '';
  outputs.forEach(out => {
    const previewUrl = `/api/preview/${encodeURIComponent(out.path)}`;
    const dlUrl = `/api/download/${encodeURIComponent(out.path)}`;
    g.innerHTML += `
      <div class="gallery-item">
        <video src="${previewUrl}" controls preload="metadata"></video>
        <div class="gi-info">
          <span class="gi-name">${out.topic || 'Video'}</span>
          <span class="gi-size">${out.size_mb}MB</span>
        </div>
        <div class="gi-actions">
          <a href="${dlUrl}" class="btn btn-sm btn-secondary" download>ğŸ“¥ ë‹¤ìš´ë¡œë“œ</a>
          <button class="btn btn-sm btn-secondary" onclick="window.open('${previewUrl}','_blank')">ğŸ”— ìƒˆ íƒ­</button>
          ${out.scenes ? `<span class="tag">${out.scenes}ì¥ë©´</span>` : ''}
          ${out.quality ? `<span class="tag purple">${out.quality}</span>` : ''}
        </div>
      </div>
    `;
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  JOB LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadJobs() {
  try {
    const data = await fetch('/api/jobs?limit=30').then(r => r.json());
    renderJobList(data.jobs || []);
  } catch (e) {
    console.error('Failed to load jobs:', e);
  }
}

function renderJobList(jobs) {
  const container = document.getElementById('jobList');
  if (!jobs.length) {
    container.innerHTML = '<div class="empty-state"><div class="es-icon">ğŸ“‚</div>ì•„ì§ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }

  container.innerHTML = '';
  jobs.forEach(j => {
    const statusClass = j.status || 'pending';
    const statusText = {
      pending: 'ëŒ€ê¸°', running: 'ì§„í–‰ì¤‘', completed: 'ì™„ë£Œ',
      failed: 'ì‹¤íŒ¨', cancelled: 'ì·¨ì†Œ'
    }[j.status] || j.status;

    const hasOutputs = j.output_files && j.output_files.length > 0;
    const timeAgo = j.created_at ? formatTimeAgo(j.created_at) : '';

    container.innerHTML += `
      <div class="job-item" id="job-${j.id}">
        <div class="ji-row">
          <span class="ji-title">${j.title || j.id}</span>
          <span class="ji-status ${statusClass}">${statusText}</span>
        </div>
        <div class="ji-meta">${timeAgo} ${j.duration_sec ? `| ${j.duration_sec}s` : ''} ${j.message ? `| ${j.message}` : ''}</div>
        ${j.status === 'running' ? `<div class="ji-progress"><div class="bar" style="width:${j.progress || 0}%"></div></div>` : ''}
        <div class="ji-actions">
          ${hasOutputs ? `<button class="btn btn-sm btn-green" onclick="viewJobOutputs('${j.id}')">ğŸ¬ ë³´ê¸°</button>` : ''}
          ${j.status === 'running' ? `<button class="btn btn-sm btn-secondary" onclick="cancelJob('${j.id}')">â¹ ì·¨ì†Œ</button>` : ''}
          <button class="btn btn-sm btn-danger" onclick="deleteJob('${j.id}')">ğŸ—‘</button>
        </div>
      </div>
    `;
  });
}

function updateJobInList(job) {
  const el = document.getElementById(`job-${job.id}`);
  if (el) {
    // Refresh the whole list for simplicity
    loadJobs();
  }
}

async function viewJobOutputs(jobId) {
  try {
    const data = await fetch(`/api/job/${jobId}`).then(r => r.json());
    if (data.output_files && data.output_files.length > 0) {
      renderGallery(data.output_files);
    }
  } catch (e) {
    console.error('Failed to load job outputs:', e);
  }
}

async function cancelJob(jobId) {
  await fetch(`/api/job/${jobId}/cancel`, { method: 'POST' });
  loadJobs();
}

async function deleteJob(jobId) {
  if (!confirm('ì´ ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì˜ìƒ íŒŒì¼ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;
  try {
    await fetch(`/api/job/${jobId}/delete`, { method: 'DELETE' });
    loadJobs();
  } catch (e) {
    alert('ì‚­ì œ ì‹¤íŒ¨: ' + e.message);
  }
}

async function deleteAllJobs() {
  if (!confirm('ì™„ë£Œ/ì‹¤íŒ¨/ì·¨ì†Œëœ ëª¨ë“  ì‘ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  try {
    const data = await fetch('/api/jobs/delete-all', { method: 'DELETE' }).then(r => r.json());
    alert(`${data.deleted}ê°œ ì‘ì—… ì‚­ì œ ì™„ë£Œ`);
    loadJobs();
  } catch (e) {
    alert('ì‚­ì œ ì‹¤íŒ¨: ' + e.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TRENDS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadTrends() {
  try {
    const data = await fetch('/api/trends').then(r => r.json());
    const container = document.getElementById('trendList');
    container.innerHTML = '';
    (data.trends || []).forEach(t => {
      container.innerHTML += `
        <div style="display:flex;align-items:center;gap:6px;padding:4px 0;border-bottom:1px solid rgba(48,54,61,.3);cursor:pointer"
             onclick="document.getElementById('legacyTopics').value+=this.querySelector('.tt').textContent+'\\n'">
          <span style="font-size:12px">${t.icon}</span>
          <span style="font-size:10px;color:var(--text3);width:16px">${t.rank}.</span>
          <span class="tt" style="font-size:10.5px;flex:1">${t.title}</span>
          <span style="font-size:9px;color:var(--text3)">${t.views}</span>
          ${t.hot ? '<span class="tag red" style="font-size:7px">HOT</span>' : ''}
        </div>
      `;
    });
  } catch (e) {
    console.error('Failed to load trends:', e);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  METRICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function refreshMetrics() {
  if (S.socket) S.socket.emit('ping_metrics');
}

function renderMetrics(m) {
  document.getElementById('sysC').textContent = `${m.cpu}% | ${m.cpu_threads}T`;
  document.getElementById('sysR').textContent = `${m.ram_used_gb}/${m.ram_total_gb}GB (${m.ram_pct}%)`;
  document.getElementById('sysD').textContent = `${m.disk_used_gb}/${m.disk_total_gb}GB (${m.disk_pct}%)`;
  document.getElementById('sysW').textContent = m.wsl2 ? 'âœ… Yes' : 'âŒ No';
  document.getElementById('sysCU').textContent = m.comfyui ? 'âœ… Connected' : 'âŒ Not found';

  const g = m.gpu || {};
  document.getElementById('sysG').textContent = g.available ? `${g.name} ${g.util}%` : 'N/A';
  document.getElementById('sysV').textContent = g.available ? `${g.mem_used}/${g.mem_total}MB` : 'N/A';
  document.getElementById('sysT').textContent = g.available ? `${g.temp}Â°C` : 'N/A';
  document.getElementById('sysP').textContent = g.available ? `${g.power}W` : 'N/A';

  gpu_name = g.name || '-';

  // Update progress GPU info if active
  document.getElementById('pgGpuName').textContent = g.name || '-';
  document.getElementById('pgVram').textContent = g.available ? `${g.mem_used}/${g.mem_total}MB` : '-';
  document.getElementById('pgTemp').textContent = g.available ? `${g.temp}Â°C` : '-';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function refreshModels() {
  try {
    const data = await fetch('/api/ollama/models').then(r => r.json());
    const sel = document.getElementById('modelSelect');
    sel.innerHTML = '';
    (data.models || []).forEach(m => {
      const sz = m.size ? `(${(m.size / 1e9).toFixed(1)}GB)` : '';
      sel.innerHTML += `<option value="${m.name}" ${m.name === data.current ? 'selected' : ''}>${m.name} ${sz}</option>`;
    });
    if (!data.models?.length) {
      sel.innerHTML = '<option>ëª¨ë¸ ì—†ìŒ</option>';
    }
    document.getElementById('modelInfo').textContent =
      data.available ? `Ollama ì—°ê²°ë¨ | í˜„ì¬: ${data.current}` : 'Ollama ë¯¸ì—°ê²°';
    setDot('dotOllama', data.available);
  } catch (e) {
    console.error('Model refresh failed:', e);
  }
}

async function switchModel() {
  const model = document.getElementById('modelSelect').value;
  try {
    await fetch('/api/ollama/switch', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ model }),
    });
    document.getElementById('modelInfo').textContent = `ëª¨ë¸ ë³€ê²½: ${model}`;
  } catch (e) {
    console.error('Model switch failed:', e);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openSettings() {
  document.getElementById('settingsModal').classList.add('active');
  refreshModels();
  checkComfyUI();
}

function closeSettings() {
  document.getElementById('settingsModal').classList.remove('active');
}

function saveSettings() {
  const settings = {
    username: document.getElementById('setUsername').value,
    avatar: document.getElementById('setAvatar').value,
    defaultPreset: document.getElementById('setDefaultPreset')?.value,
    defaultVoice: document.getElementById('setDefaultVoice')?.value,
    defaultQuality: document.getElementById('setDefaultQuality').value,
  };
  localStorage.setItem('shorts_settings', JSON.stringify(settings));
  alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function saveSocialSettings() {
  const social = {
    youtube_api_key: document.getElementById('setYtApiKey').value,
    youtube_oauth: document.getElementById('setYtOauth').value,
    instagram_token: document.getElementById('setIgToken').value,
    x_token: document.getElementById('setXToken').value,
    tiktok_token: document.getElementById('setTikToken').value,
  };
  localStorage.setItem('shorts_social', JSON.stringify(social));
  alert('ì†Œì…œ ë¯¸ë””ì–´ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function loadSettings() {
  try {
    const settings = JSON.parse(localStorage.getItem('shorts_settings') || '{}');
    if (settings.username) document.getElementById('setUsername').value = settings.username;
    if (settings.avatar) document.getElementById('setAvatar').value = settings.avatar;

    const social = JSON.parse(localStorage.getItem('shorts_social') || '{}');
    if (social.youtube_api_key) document.getElementById('setYtApiKey').value = social.youtube_api_key;
    if (social.youtube_oauth) document.getElementById('setYtOauth').value = social.youtube_oauth;
    if (social.instagram_token) document.getElementById('setIgToken').value = social.instagram_token;
    if (social.x_token) document.getElementById('setXToken').value = social.x_token;
    if (social.tiktok_token) document.getElementById('setTikToken').value = social.tiktok_token;
  } catch (e) {}
}

async function checkComfyUI() {
  const el = document.getElementById('comfyStatus');
  el.innerHTML = '<span class="spinner"></span> í™•ì¸ ì¤‘...';
  try {
    const data = await fetch('/api/comfyui/status').then(r => r.json());
    if (data.available) {
      const vramGB = data.vram_free ? (data.vram_free / 1073741824).toFixed(1) : '?';
      const vramTotalGB = data.vram_total ? (data.vram_total / 1073741824).toFixed(1) : '?';
      const ckptCount = data.checkpoint_count || 0;
      const ckptList = (data.checkpoints || []).map(c => `<div style="padding:1px 0;color:var(--accent)">â€¢ ${c}</div>`).join('');
      const ckptSection = ckptCount > 0
        ? `<div style="margin-top:4px"><b>ì²´í¬í¬ì¸íŠ¸ (${ckptCount}ê°œ):</b>${ckptList}</div>`
        : '<div style="margin-top:4px;color:var(--red)">âš ï¸ ì²´í¬í¬ì¸íŠ¸ ì—†ìŒ! models/checkpoints/ í´ë”ì— ëª¨ë¸ì„ ë„£ì–´ì£¼ì„¸ìš”</div>';
      el.innerHTML = `
        <span class="text-green">âœ… ì—°ê²°ë¨</span>
        <div style="font-size:10px;margin-top:4px;padding:6px;background:var(--deep);border-radius:4px">
          VRAM: ${vramGB}GB / ${vramTotalGB}GB | ë¡œë“œëœ ëª¨ë¸: ${data.models_loaded || 0}
          ${ckptSection}
        </div>
      `;
      setDot('dotComfy', true);
    } else {
      el.innerHTML = '<span class="text-red">âŒ ì—°ê²° ì•ˆë¨</span> â€” ComfyUIë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”';
      setDot('dotComfy', false);
    }
  } catch (e) {
    el.innerHTML = '<span class="text-red">âŒ ì—°ê²° ì‹¤íŒ¨</span>';
    setDot('dotComfy', false);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COMFYUI LOG CONSOLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function appendComfyLog(entry) {
  const console = document.getElementById('comfyLogConsole');
  if (!console) return;

  const colorMap = {
    ERROR: 'var(--red)', WARN: 'var(--yellow)',
    SUCCESS: 'var(--green)', INFO: 'var(--text2)',
  };
  const color = colorMap[entry.level] || 'var(--text2)';
  const line = document.createElement('div');
  line.className = 'comfy-log-line';
  line.style.color = color;
  line.textContent = `[${entry.time}] ${entry.message}`;
  console.appendChild(line);

  // Keep max 200 lines
  while (console.children.length > 200) {
    console.removeChild(console.firstChild);
  }
  console.scrollTop = console.scrollHeight;
}

function clearComfyLogs() {
  const console = document.getElementById('comfyLogConsole');
  console.innerHTML = '<div class="comfy-log-line" style="color:var(--text3)">ë¡œê·¸ ì´ˆê¸°í™”ë¨</div>';
}

async function fetchComfyLogs() {
  try {
    const data = await fetch('/api/comfyui/logs?lines=50').then(r => r.json());
    const console = document.getElementById('comfyLogConsole');
    console.innerHTML = '';
    (data.logs || []).forEach(entry => appendComfyLog(entry));
    if (!data.logs || data.logs.length === 0) {
      console.innerHTML = '<div class="comfy-log-line" style="color:var(--text3)">ë¡œê·¸ ì—†ìŒ</div>';
    }
  } catch (e) {
    console.error('Failed to fetch ComfyUI logs:', e);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ACTIVE JOB PANEL (Right sidebar)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateActiveJobPanel(data) {
  const body = document.getElementById('activeJobsBody');
  const tag = document.getElementById('jobStatusTag');
  if (!body) return;

  const pct = data.progress || 0;
  const step = data.step || data.current_step || data.message || 'ì²˜ë¦¬ ì¤‘...';
  const status = data.status || 'running';

  if (status === 'running' || pct > 0) {
    tag.style.display = 'inline';
    tag.textContent = `${pct}%`;
    tag.className = 'tag green';

    body.innerHTML = `
      <div style="font-size:10px">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px">
          <span style="color:var(--cyan)">${step}</span>
          <span class="mono" style="color:var(--green)">${pct}%</span>
        </div>
        <div style="height:4px;background:var(--deep);border-radius:2px;overflow:hidden;margin-bottom:6px">
          <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,var(--cyan),var(--purple));transition:width .5s"></div>
        </div>
        <div id="activeJobScenes" style="max-height:120px;overflow-y:auto;font-size:9px;color:var(--text3)"></div>
        <div id="activeJobEta" style="font-size:9px;color:var(--text2);margin-top:4px"></div>
      </div>
    `;
  }
}

function resetActiveJobPanel() {
  const body = document.getElementById('activeJobsBody');
  const tag = document.getElementById('jobStatusTag');
  if (body) body.innerHTML = '<div class="empty-state" style="padding:10px"><div class="es-icon">âœ¨</div>ëŒ€ê¸° ì¤‘</div>';
  if (tag) tag.style.display = 'none';
}

async function checkUpdate() {
  const el = document.getElementById('updateResult');
  el.innerHTML = '<span class="spinner"></span> í™•ì¸ ì¤‘...';
  try {
    const data = await fetch('/api/version').then(r => r.json());
    el.innerHTML = `
      <div style="padding:8px;background:var(--deep);border-radius:6px;font-size:10px">
        í˜„ì¬: v${data.app_version}<br>
        Python: ${data.python}<br>
        GPU: ${data.gpu?.name || 'N/A'}<br>
        ComfyUI: ${data.comfyui_available ? 'âœ…' : 'âŒ'}<br>
        Ollama: ${data.ollama_available ? 'âœ…' : 'âŒ'}<br>
        <br>
        <span class="text-green">âœ… ìµœì‹  ë²„ì „ì…ë‹ˆë‹¤</span>
      </div>
    `;
  } catch (e) {
    el.innerHTML = '<span class="text-red">âŒ í™•ì¸ ì‹¤íŒ¨</span>';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KEYBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initKeyboard() {
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeSettings();
    if (e.ctrlKey && e.key === 'Enter') {
      const activeTab = document.querySelector('.nav-tab.active')?.dataset.tab;
      if (activeTab === 'create') genScenarios();
      else if (activeTab === 'legacy') startLegacy();
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function formatTimeAgo(iso) {
  try {
    const d = new Date(iso);
    const diff = (Date.now() - d.getTime()) / 1000;
    if (diff < 60) return 'ë°©ê¸ˆ';
    if (diff < 3600) return `${Math.floor(diff / 60)}ë¶„ ì „`;
    if (diff < 86400) return `${Math.floor(diff / 3600)}ì‹œê°„ ì „`;
    return `${Math.floor(diff / 86400)}ì¼ ì „`;
  } catch { return ''; }
}
</script>
</body>
</html>
